<h1 align=center> SYSUCODER 逸仙码头📕 </h1>

<p align=center> 
  <a href="https://github.com/LulietLyan?tab=followers"> <img src="https://img.shields.io/github/followers/LulietLyan?label=Followers&style=for-the-badge&color=purple" height="25px" alt="github follow" > </a>
  <a href="https://github.com/LulietLyan/SYSUCoder?tab=stars"> <img src="https://img.shields.io/github/stars/LulietLyan/SYSUCoder?label=Stars&style=for-the-badge" height="25px" alt="github repo stars" > </a>
  <a href="https://github.com/LulietLyan/SYSUCoder"> <img src="https://img.shields.io/badge/github-%23121011.svg?style=for-the-badge&logo=github&logoColor=white" height="25px" alt="github repo stars" > </a>
  <a href="https://github.com/LulietLyan/SYSUCoder"> <img src="https://img.shields.io/badge/mysql-4479A1.svg?style=for-the-badge&logo=mysql&logoColor=white" height="25px" alt="github repo stars" > </a>
</p> 

---
---

# Contents
- [Contents](#contents)
- [项目结构](#项目结构)
- [中间件实现](#中间件实现)
  - [概述](#概述)
  - [中间件列表](#中间件列表)
  - [核心功能模块](#核心功能模块)
    - [身份识别中间件（TokenGetInfo）](#身份识别中间件tokengetinfo)
  - [权限控制体系](#权限控制体系)
    - [角色权限对照表](#角色权限对照表)
    - [权限验证中间件](#权限验证中间件)
  - [系统配置参数](#系统配置参数)
  - [接口集成规范](#接口集成规范)
    - [中间件加载顺序](#中间件加载顺序)
    - [客户端处理要求](#客户端处理要求)
  - [性能优化方案](#性能优化方案)
    - [缓存策略](#缓存策略)
  - [异常代码对照表](#异常代码对照表)
- [模块化路由](#模块化路由)
  - [用户路由组](#用户路由组)
    - [路由结构概览](#路由结构概览)
    - [路由组详情](#路由组详情)
      - [1. 公开路由组](#1-公开路由组)
      - [2. 普通用户路由组](#2-普通用户路由组)
      - [3. 管理员路由组](#3-管理员路由组)
      - [4. 超级管理员路由组](#4-超级管理员路由组)
    - [中间件说明](#中间件说明)
      - [权限验证中间件](#权限验证中间件-1)
    - [接口访问流程](#接口访问流程)
  - [题目路由组](#题目路由组)
  - [标签路由组](#标签路由组)
  - [题解路由组](#题解路由组)
  - [测试样例路由组](#测试样例路由组)
  - [判题路由组](#判题路由组)
  - [历史记录路由组](#历史记录路由组)
  - [博客路由组](#博客路由组)
  - [评论路由组](#评论路由组)
  - [AI 服务路由组](#ai-服务路由组)
  - [静态服务路由组](#静态服务路由组)
  - [系统路由组](#系统路由组)
  - [杂项路由组](#杂项路由组)


# 项目结构

# 中间件实现

## 概述

本系统基于Gin框架实现了一套完整的Token鉴权中间件，主要包含以下功能模块：
1. 用户身份信息自动提取
2. 多层级角色权限控制
3. Token自动刷新机制
4. 统一的错误响应处理

---

## 中间件列表

| 中间件名称          | 功能描述                          | 适用场景                |
|:---------------------:|:----------------------------------:|:------------------------:|
| TokenGetInfo        | 解析Token并注入用户信息到上下文   | 所有需要身份识别的接口  |
| TokenAuthUser       | 验证用户权限（≥普通用户）         | 普通用户专属接口        |
| TokenAuthEditor     | 验证用户权限（≥编辑）             | 内容管理接口            |
| TokenAuthAdmin      | 验证用户权限（≥管理员）           | 系统管理接口            |
| TokenAuthRoot       | 验证用户权限（≥超级管理员）       | 核心配置接口            |

## 核心功能模块

### 身份识别中间件（TokenGetInfo）
**处理流程**  
1. **请求头Token检测**
   - 未携带Token自动标记为访客身份  
   - 默认注入用户ID:0 角色:RoleVisitor  

2. **有效Token解析**
   - 解析失败返回401状态码及错误信息  
   - 错误示例：`{"code":401, "message":"获取用户id失败"}`  

3. **用户角色查询**
   - 数据库查询失败返回401错误  
   - 错误示例：`{"code":401, "message":"无法查询到用户组"}`  

4. **令牌自动续期** 
   - 有效期剩余不足30分钟时触发刷新  
   - 响应示例：`{"code":401, "message":"token已刷新", "data":"新令牌"}`  

---

## 权限控制体系

### 角色权限对照表
| 角色标识          | 权限等级 | 权限范围                 |
|--------------------|----------|--------------------------|
| ROLE_VISITOR       | 0        | 公开接口访问权限         |
| ROLE_USER          | 1        | 用户个人功能操作权限     |
| ROLE_EDITOR        | 2        | 内容管理操作权限         |
| ROLE_ADMIN         | 3        | 系统配置管理权限         |
| ROLE_ROOT          | 4        | 超级管理员权限           |

### 权限验证中间件
**典型验证逻辑**  
- 用户权限校验：要求 ≥ROLE_USER  
- 编辑权限校验：要求 ≥ROLE_EDITOR  
- 管理员校验：要求 ≥ROLE_ADMIN  
- 根权限校验：要求 ROLE_ROOT  

**异常处理**  
- 权限不足返回403状态码  
- 错误示例：`{"code":403, "message":"权限不足"}`  

---

## 系统配置参数
**令牌配置项**  
- 有效期：86400秒（24小时）  
- 刷新阈值：1800秒（30分钟）  
- 签发机构：Sysucoder Auth Center  
- 签名算法：HMAC-SHA256  

---

## 接口集成规范

### 中间件加载顺序
1. 基础身份识别中间件  
2. 业务路由分组  
3. 权限校验中间件  

**正确示例**  
`全局加载TokenGetInfo → 路由组加载TokenAuthAdmin → 注册管理接口`

### 客户端处理要求
**令牌刷新流程**  
1. 检测401响应状态码  
2. 解析响应体中的new_token字段  
3. 更新本地存储的访问令牌  
4. 自动重试原始请求  

**建议请求头格式**  
Authorization: Bearer <your_token>

---

## 性能优化方案

### 缓存策略
**用户角色缓存**  
- 存储介质：Redis集群  
- 缓存时长：300秒  
- 更新机制：用户信息变更时主动清除  

**数据库优化**  
- 建立用户ID索引  
- 使用连接池技术  
- 启用查询结果缓存  

---

## 异常代码对照表
| 状态码 | 错误类型           | 典型场景                 |
|--------|--------------------|--------------------------|
| 401    | 身份验证失败       | Token过期/无效           |
| 403    | 权限不足           | 用户尝试访问管理接口      |
| 500    | 服务器内部错误     | 数据库连接失败           |



# 模块化路由

## 用户路由组

### 路由结构概览
本系统用户模块采用四级权限控制体系，通过路由分组实现接口权限分层管理。包含以下路由组：
- **公开路由组**：无需身份验证
- **普通用户路由组**：需登录验证
- **管理员路由组**：需管理员权限
- **超级管理员路由组**：需根权限

---

### 路由组详情

#### 1. 公开路由组
**路径前缀**：`/user`  
**中间件**：无  
**包含接口**：

| 请求方法 | 接口路径         | 处理函数           | 功能描述         |
|----------|------------------|--------------------|------------------|
| GET      | /:id             | UserInfo           | 查询用户基本信息 |
| POST     | /login           | UserLogin          | 用户登录         |
| POST     | /register        | UserRegister       | 用户注册         |
| PUT      | /password        | UserChangePassword | 修改用户密码     |

---

#### 2. 普通用户路由组
**路径前缀**：`/user`  
**中间件**：`TokenAuthUser`（需普通用户权限）  
**包含接口**：

| 请求方法 | 接口路径          | 处理函数         | 功能描述         |
|----------|-------------------|------------------|------------------|
| GET      | /current          | UserCurrentId    | 获取当前用户ID   |
| PUT      | /modify/:id       | UserModify       | 修改用户信息     |
| POST     | /avatar/:id       | ModifyUserAvatar | 更新用户头像     |

---

#### 3. 管理员路由组
**路径前缀**：`/user`  
**中间件**：`TokenAuthAdmin`（需管理员权限）  
**包含接口**：

| 请求方法 | 接口路径  | 处理函数       | 功能描述         |
|----------|-----------|----------------|------------------|
| GET      | /         | UserList       | 获取用户列表     |
| POST     | /         | UserAdd        | 添加新用户       |
| PUT      | /role     | UserModifyRole | 修改用户角色     |

---

#### 4. 超级管理员路由组
**路径前缀**：`/user`  
**中间件**：`TokenAuthRoot`（需超级管理员权限）  
**包含接口**：

| 请求方法 | 接口路径  | 处理函数   | 功能描述     |
|----------|-----------|------------|--------------|
| DELETE   | /:id      | UserRemove | 删除用户账户 |

---

### 中间件说明

#### 权限验证中间件
| 中间件名称        | 权限要求               | 失败响应状态码 |
|:--------------------:|:------------------------:|:----------------:|
| TokenAuthUser      | 用户角色 ≥ 普通用户    | 403 Forbidden  |
| TokenAuthAdmin     | 用户角色 ≥ 管理员      | 403 Forbidden  |
| TokenAuthRoot      | 用户角色 = 超级管理员  | 403 Forbidden  |

---

### 接口访问流程
```plaintext
客户端请求
↓
路由匹配
↓
中间件链执行（身份验证 → 权限校验）
↓
业务处理函数
↓
响应返回
```

## 题目路由组

## 标签路由组

## 题解路由组

## 测试样例路由组

## 判题路由组

## 历史记录路由组

## 博客路由组

## 评论路由组

## AI 服务路由组

## 静态服务路由组

## 系统路由组

## 杂项路由组
